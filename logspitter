#!/bin/bash

# First checks if Logspitter has been previously installed. If not, exits 0.
if [[ ! -e /usr/bin/logspitter ]]
then
	echo "You don't currently have Logspitter installed. Please run the 'INSTALL' script."
	exit 0
fi

echo "Please drag your log file HERE and press ENTER"
read logfile

if [[ $logfile == *.log ]] ## will read Producer/Procaster logs
then
	echo "Thanks. Processing now..."

	egrep -i '(error)|(fail)|(false)|(rtmp://)|(port)|(\!)\|(drop)|(stamp)|(lost)|(connect)|(connection)|(auth)|(slow)|(check)|(quality)|(suggestion)' $logfile > /tmp/Logs.txt && open /tmp/Logs.txt

	echo "All done."

elif
	[[ $logfile == *.txt ]] ## will read Studio logs

then
	echo "Thanks. Processing now..."

	egrep -i '(error=203)|(error=301)|error=)|(not\ found)|(rtmp://)|(http_status)|(usage)|(motherboard)|(lost)|(connect)|(connection)|(auth)|(tcp)|(socket)|(deleted)|(network)|(zixi)|(udp)|(code=)' $logfile > /tmp/Logs.filtered.txt | uniq -d -i && open /tmp/Logs.filtered.txt

	echo "All done."
	echo "Remember, this to help narrow down possible causes. It's still recommended"
	echo "that you view the entire log file -- you may otherwise miss crucial context"
else
	echo "Oops - not a valid log file. Please use a Studio '.txt' or Producer '.log' file and try again."

fi
